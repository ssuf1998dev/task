# yaml-language-server: $schema=../../website/static/next-schema.json
version: "3"

includes:
  include: ./Taskfile.include.yaml

tasks:
  whoami:
    ssh: //root:foobar@{{.HOST}}?insecure&timeout=3
    cmd: whoami
    preconditions:
      - command -v whoami

  whoami-local:
    ssh:
      url: //root:foobar@{{.HOST}}?insecure
      disabled: true
    cmd: whoami

  whoami-3-times:
    ssh: //root:foobar@{{.HOST}}?insecure&timeout=3
    cmds:
      - for: ["0", "1", "2"]
        cmd: whoami

  whoami-include:
    ssh: //root:foobar@{{.HOST}}?insecure&timeout=3
    cmds:
      - task: "include:whoami"
      - task: "include:whoami-local"

  ls:
    ssh:
      addr: "{{.HOST}}"
      user: root
      password: foobar
      insecure: true
    cmd: ls -a

  env:
    env:
      FOO: BAR
    ssh: //root:foobar@{{.HOST}}?insecure
    cmd: echo $FOO

  upload:
    ssh:
      url: //root:foobar@{{.HOST}}?insecure
      uploads:
        - ./Taskfile.yaml:/root/Taskfile.yaml
    cmds:
      - ls -a /root
      - defer: rm -rf /root/Taskfile.yaml
